#!C:\Users\Lenovo\AppData\Local\Programs\Python\Python37-32\python.exe

import numpy as np
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.ensemble import StackingClassifier
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import confusion_matrix
from sklearn.neighbors import KNeighborsClassifier
import warnings
import pickle
warnings.filterwarnings("ignore")

df=pd.read_csv("https://raw.githubusercontent.com/Gokulgoky1/Data_sets/main/pe_section_headers.csv")
df=df.dropna()
df.drop_duplicates(keep=False,inplace=True)
x=df.iloc[:,1:-1]
y=df.iloc[:,-1]

X_train, X_test, y_train, y_test = train_test_split(x, y,test_size=.2,stratify=y ,random_state=42 )

estimators = [  ('rf', RandomForestClassifier(n_estimators=50, random_state=42)),
              ('knn', KNeighborsClassifier(n_neighbors=31, metric='minkowski', p=2 ))]
clf = StackingClassifier(estimators=estimators)
print("Accuracy:",clf.fit(X_train, y_train).score(X_test,y_test))
y_pred=clf.predict(X_test)
y_act=y_test
cm=confusion_matrix(y_act,y_pred)
print(cm)


pickle.dump(clf,open('model.pkl','wb'))
model=pickle.load(open('model.pkl','rb'))


